{% extends "custom_admin/base.html" %}

{% block title %}{{ action }} Coupon{% endblock %}

{% block content %}
<div class="max-w-lg mx-auto my-6 p-6 bg-white rounded-lg shadow-md">
    <h2 class="text-2xl font-bold mb-4">{{ action }} Coupon</h2>

    <form method="post" class="space-y-4" novalidate>
        {% csrf_token %}

        <!-- Coupon Code -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Coupon Code</label>
            <input type="text" name="code" value="{{ coupon.code|default:'' }}"
                   class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 {% if error.code %}border-red-500{% endif %}">
            {% if error.code %}<p class="text-red-600 text-sm mt-1">{{ error.code }}</p>{% endif %}
        </div>

        <!-- Discount Value -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Discount Value (â‚¹)</label>
            <input type="number" name="discount_value" step="0.01"
                   value="{{ coupon.discount_value|default:'' }}"
                   class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 {% if error.discount_value %}border-red-500{% endif %}">
            {% if error.discount_value %}<p class="text-red-600 text-sm mt-1">{{ error.discount_value }}</p>{% endif %}
        </div>

        <!-- Valid From -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Valid From</label>
            <input type="date" name="valid_from"
                   value="{{ coupon.valid_from|date:'Y-m-d'|default:'' }}"
                   class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 {% if error.valid_from %}border-red-500{% endif %}">
            {% if error.valid_from %}<p class="text-red-600 text-sm mt-1">{{ error.valid_from }}</p>{% endif %}
        </div>

        <!-- Valid To -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Valid To</label>
            <input type="date" name="valid_to"
                   value="{{ coupon.valid_to|date:'Y-m-d'|default:'' }}"
                   class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 {% if error.valid_to %}border-red-500{% endif %}">
            {% if error.valid_to %}<p class="text-red-600 text-sm mt-1">{{ error.valid_to }}</p>{% endif %}
        </div>

        <!-- Usage Limit Total -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Total Usage Limit</label>
            <input type="number" name="usage_limit_total"
                   value="{{ coupon.usage_limit_total|default:0 }}"
                   class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 {% if error.usage_limit_total %}border-red-500{% endif %}">
            {% if error.usage_limit_total %}<p class="text-red-600 text-sm mt-1">{{ error.usage_limit_total }}</p>{% endif %}
        </div>

        <!-- Usage Limit Per User -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Usage Limit Per User</label>
            <input type="number" name="usage_limit_per_user"
                   value="{{ coupon.usage_limit_per_user|default:0 }}"
                   class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 {% if error.usage_limit_per_user %}border-red-500{% endif %}">
            {% if error.usage_limit_per_user %}<p class="text-red-600 text-sm mt-1">{{ error.usage_limit_per_user }}</p>{% endif %}
        </div>

        <!-- Active Checkbox -->
        <div class="flex items-center">
            <input type="checkbox" name="active" id="active"
                   class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                   {% if coupon.active or coupon is not defined %}checked{% endif %}>
            <label for="active" class="ml-2 block text-sm text-gray-700">Active</label>
        </div>

        <!-- Product Selection -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Applicable Products</label>
            <select name="products" multiple
                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                {% for product in products %}
                    <option value="{{ product.id }}"
                        {% if coupon.products.all|default_if_none:'' and product in coupon.products.all %}selected{% endif %}>
                        {{ product.name }}
                    </option>
                {% endfor %}
            </select>
            <p class="text-gray-500 text-sm mt-1">Select products this coupon will apply to. Leave empty for all products.</p>
        </div>

        <!-- Buttons -->
        <div class="flex space-x-2">
            <button type="submit"
                    class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded font-medium">
                {{ action }} Coupon
            </button>
            <a href="{% url 'admin_coupon_list' %}"
               class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded font-medium">
                Cancel
            </a>
        </div>
    </form>
</div>
{% endblock %}
