{% extends 'custom_admin/base.html' %}
{% load static %}

{% block title %}Edit Product - {{ product.name }}{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto bg-white shadow-md rounded-2xl p-8 mt-8">
  <h2 class="text-2xl font-semibold text-gray-800 mb-6">Edit Product</h2>

  <form method="POST" enctype="multipart/form-data" class="space-y-6">
    {% csrf_token %}

    <!-- Product Info -->
    <div>
      <label class="block text-gray-700 font-medium mb-1">Product Name</label>
      <input type="text" name="name" value="{{ product.name }}"
             class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-indigo-500 {% if errors.name %}border-red-500{% endif %}">
      {% if errors.name %}
        <p class="text-red-500 text-sm mt-1">{{ errors.name }}</p>
      {% endif %}
    </div>

    <div>
      <label class="block text-gray-700 font-medium mb-1">Brand</label>
      <input type="text" name="brand" value="{{ product.brand }}"
             class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-indigo-500 {% if errors.brand %}border-red-500{% endif %}">
      {% if errors.brand %}
        <p class="text-red-500 text-sm mt-1">{{ errors.brand }}</p>
      {% endif %}
    </div>

    <div>
      <label class="block text-gray-700 font-medium mb-1">Description</label>
      <textarea name="description"
                class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-indigo-500 {% if errors.description %}border-red-500{% endif %}">{{ product.description }}</textarea>
      {% if errors.description %}
        <p class="text-red-500 text-sm mt-1">{{ errors.description }}</p>
      {% endif %}
    </div>

    <div>
      <label class="block text-gray-700 font-medium mb-1">Category</label>
      <select name="category"
              class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-indigo-500 {% if errors.category %}border-red-500{% endif %}">
        <option value="">-- Select Category --</option>
        {% for c in categories %}
          <option value="{{ c.id }}" {% if product.category.id == c.id %}selected{% endif %}>{{ c.name }}</option>
        {% endfor %}
      </select>
      {% if errors.category %}
        <p class="text-red-500 text-sm mt-1">{{ errors.category }}</p>
      {% endif %}
    </div>

    <!-- Main Image -->
    <div>
      <label class="block text-gray-700 font-medium mb-1">Main Image</label>
      {% if product.image %}
        <img id="image-preview" src="{{ product.image.url }}" alt="Main Image"
             class="mb-2 w-32 h-32 object-cover rounded-lg shadow-sm">
      {% else %}
        <img id="image-preview" style="display:none;" class="mb-2 w-32 h-32 object-cover rounded-lg shadow-sm">
      {% endif %}
      <input type="file" id="image-input" name="cropped_image"
             class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-indigo-500 {% if errors.image %}border-red-500{% endif %}">
      {% if errors.image %}
        <p class="text-red-500 text-sm mt-1">{{ errors.image }}</p>
      {% endif %}
    </div>

    <!-- Active Checkbox -->
    <div class="flex items-center gap-2">
      <input type="checkbox" name="is_active" id="is_active" class="h-4 w-4 text-indigo-600 rounded" {% if product.is_active %}checked{% endif %}>
      <label for="is_active" class="text-gray-700 font-medium">Active</label>
    </div>

    <hr class="my-6">

    <!-- Variants -->
    <div>
      <h3 class="text-lg font-semibold text-gray-800 mb-3">Existing Variants</h3>
      <div class="overflow-x-auto border border-gray-200 rounded-lg">
        <table class="min-w-full divide-y divide-gray-200 text-gray-700">
          <thead class="bg-gray-100">
            <tr>
              <th class="px-4 py-2 text-left font-medium">Color</th>
              <th class="px-4 py-2 text-left font-medium">Size</th>
              <th class="px-4 py-2 text-left font-medium">Price</th>
              <th class="px-4 py-2 text-left font-medium">Stock</th>
              <th class="px-4 py-2 text-left font-medium">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100">
            {% for v in variants %}
            <tr class="hover:bg-gray-50">
              <td class="px-4 py-2">{{ v.color }}</td>
              <td class="px-4 py-2">{{ v.size }}</td>
              <td class="px-4 py-2">â‚¹{{ v.price }}</td>
              <td class="px-4 py-2">{{ v.stock }}</td>
              <td class="px-4 py-2 flex gap-2">
                <a href="{% url 'admin_variant_edit' v.id %}" class="px-2 py-1 border border-indigo-500 text-indigo-600 rounded hover:bg-indigo-50 text-sm">Edit</a>
                <a href="{% url 'admin_variant_delete' v.id %}" class="px-2 py-1 border border-red-500 text-red-600 rounded hover:bg-red-50 text-sm">Delete</a>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="5" class="px-4 py-2 text-gray-500 text-center">No variants yet.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <a href="{% url 'admin_variant_add' product.id %}"
         class="inline-block mt-3 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition text-sm">+ Add Variant</a>
    </div>

    <hr class="my-6">

    <!-- Additional Images -->
   <div>
        <h3 class="text-lg font-semibold text-gray-800 mb-3">Additional Images</h3>
        <div class="flex flex-wrap gap-4 mb-3">
            {% for img in additional_images %}
            <div class="relative w-24 h-24 group">
                <img src="{{ img.image.url }}" alt="Additional Image"
                    class="w-24 h-24 object-cover rounded-lg shadow-sm">

                <!-- Delete button overlay -->
                <button type="button"
                        onclick="document.getElementById('delete_image_{{ img.id }}').checked = true; this.parentElement.style.display='none';"
                        class="absolute top-1 right-1 bg-red-600 text-white w-6 h-6 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 hover:bg-red-700 transition"
                        title="Delete Image">
                &times;
                </button>

                <input type="hidden" name="image_id_{{ img.id }}" value="{{ img.id }}">
                <input type="checkbox" id="delete_image_{{ img.id }}" name="delete_image_{{ img.id }}" class="hidden">
            </div>
            {% endfor %}
        </div>
        <a href="{% url 'admin_image_add' product.id %}"
            class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition text-sm">+ Add Image</a>
    </div>

    <button type="submit"
            class="px-6 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition">Save Changes</button>
  </form>
</div>

<!-- Optional: Tailwind Cropper JS integration can be added similar to Add Product page -->

{% endblock %}
