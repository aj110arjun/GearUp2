{% extends 'user/base.html' %}
{% load static %}

{% block content %}
<style>
body {
    background-color: #f5f4f0;
    font-family: 'Poppins', sans-serif;
}
.order-container {
    max-width: 900px;
    margin: 40px auto;
    background: #fff;
    border-radius: 15px;
    padding: 30px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}
.order-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 2px solid #eee;
    padding-bottom: 10px;
    margin-bottom: 20px;
}
.order-header h2 {
    color: #333;
    font-weight: 600;
}
.order-info {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px 30px;
    margin-bottom: 20px;
}
.order-info p {
    margin: 5px 0;
}
.item-card {
    border: 1px solid #ddd;
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    background: #fafafa;
}
.item-card img {
    width: 90px;
    height: 90px;
    object-fit: cover;
    border-radius: 10px;
    margin-right: 20px;
}
.item-details h5 {
    margin: 0;
    font-size: 1.1rem;
    color: #333;
}
.item-details p {
    margin: 2px 0;
    color: #555;
}
.status {
    font-weight: 600;
    color: #007bff;
}
.total-section {
    text-align: right;
    font-size: 1.1rem;
    margin-top: 20px;
    border-top: 2px solid #eee;
    padding-top: 15px;
}
.btn-action {
    display: inline-block;
    background-color: #d9534f;
    color: white;
    padding: 6px 14px;
    border-radius: 8px;
    font-size: 0.9rem;
    text-decoration: none;
}
.btn-action:hover {
    background-color: #c9302c;
}
</style>

<div class="order-container">
    <div class="order-header">
        <h2>Order Details</h2>
        <span>Order ID: {{ order.order_code }}</span>
    </div>

    <div class="order-info">
        <p><strong>Date:</strong> {{ order.created_at|date:"d M Y - H:i" }}</p>
        <p><strong>Payment Method:</strong> {{ order.get_payment_method_display }}</p>
        <p><strong>Payment Status:</strong> {{ order.payment_status }}</p>
        <p><strong>Total Amount:</strong> ₹{{ order.total_price }}</p>
        {% if order.discount %}
        <p><strong>Discount:</strong> ₹{{ order.discount }}</p>
        {% endif %}
        {% if order.coupon %}
        <p><strong>Coupon:</strong> {{ order.coupon.code }}</p>
        {% endif %}
    </div>

    <h4>Items</h4>
    {% for item in order.items.all %}
    <div class="item-card">
        <img src="{{ item.variant.image.url }}" alt="{{ item.variant.product.name }}">
        <div class="item-details">
            <h5>{{ item.variant.product.name }} ( {{ item.variant.color }} / {{ item.variant.size }} )</h5>
            <p>Quantity: {{ item.quantity }}</p>
            <p>Price: ₹{{ item.price }}</p>
            <p>Status: <span class="status">{{ item.get_status_display }}</span></p>

            {% if item.status == "delivered" and not item.return_requested %}
                <a href="{% url 'return_order_item_page' item.item_id %}" class="btn-action">Request Return</a>
            {% elif item.status == "pending" and not item.cancellation_requested %}
                <a href="{% url 'cancel_order_item_page' item.item_id %}" class="btn-action">Cancel Order</a>
            {% endif %}
        </div>
    </div>
    {% empty %}
    <p>No items found for this order.</p>
    {% endfor %}

    <div class="total-section">
        {% for item in items %}
            <li class="list-group-item">
                <strong>Tax:</strong> ₹{{ item.tax }}
            </li>
        {% endfor %}
        <p><strong>Delivery Charge:</strong> ₹{{ delivery_charge }}</p>
        <p><strong>Grand Total:</strong> ₹{{ grand_total|floatformat:2 }}</p>
    </div>
</div>
{% endblock %}
