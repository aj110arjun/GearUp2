{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment - GearUp</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body class="bg-light">

    <div class="container d-flex justify-content-center align-items-center vh-100">
        <div class="card shadow-lg p-4" style="max-width: 480px; width: 100%; border-radius: 1rem;">
            
            <!-- Header -->
            <div class="text-center mb-4">
                <h3 class="fw-bold text-primary">Secure Payment</h3>
                <p class="text-muted">Pay for Order <strong>#{{ order.order_code }}</strong></p>
            </div>

            <!-- Amount -->
            <div class="text-center mb-3">
                <h2 class="text-success fw-bold">₹{{ amount }}</h2>
                <small class="text-muted">Total Amount</small>
            </div>

            <hr>

            <!-- Payment Button -->
            <div class="d-grid">
                <button id="rzp-button1" class="btn btn-lg btn-success">
                    <i class="bi bi-credit-card me-2"></i> Pay Now
                </button>
            </div>

            <!-- Secure notice -->
            <p class="text-center text-muted mt-3 mb-0" style="font-size: 0.9rem;">
                <i class="bi bi-shield-lock-fill me-1"></i>
                Payments are processed securely via Razorpay
            </p>
        </div>
    </div>

    <!-- Razorpay Script -->
    <script>
        var options = {
            "key": "{{ razorpay_key }}",  
            "amount": "{{ amount_paise }}",  // ✅ Pass paise from backend
            "currency": "{{ currency }}",
            "name": "GearUp Store",
            "description": "Order Payment",
            "order_id": "{{ razorpay_order_id }}",  
            "handler": function (response){
                fetch("{% url 'payment_success' order.order_id %}", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded",
                        "X-CSRFToken": "{{ csrf_token }}"
                    },
                    body: new URLSearchParams({
                        "razorpay_payment_id": response.razorpay_payment_id,
                        "razorpay_order_id": response.razorpay_order_id,
                        "razorpay_signature": response.razorpay_signature
                    })
                }).then(res => window.location.href = "{% url 'order_success' order.order_id %}");
            },
            "modal": {
                "ondismiss": function(){
                    window.location.href = "{% url 'payment_failed' order.order_id %}";
                }
            },
            "theme": {
                "color": "#198754"  // Bootstrap green
            }
        };

        var rzp1 = new Razorpay(options);

        rzp1.on('payment.failed', function (response){
            alert("Payment Failed: " + response.error.description);
            window.location.href = "{% url 'payment_failed' order.order_id %}";
        });

        document.getElementById('rzp-button1').onclick = function(e){
            rzp1.open();
            e.preventDefault();
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.js"></script>
</body>
</html>
